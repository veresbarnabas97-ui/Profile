<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkyAI | Pilot Dashboard</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.js"></script>

    <style>
        body { background: #020205; color: #fff; font-family: 'Exo 2', sans-serif; margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; padding-bottom: 20px; margin-bottom: 30px; }
        .logo { font-size: 1.5rem; font-weight: bold; color: #00d2ff; }
        .back-link { color: #666; text-decoration: none; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        
        .card { background: #0b0b10; border: 1px solid #333; padding: 30px; border-radius: 12px; }
        .card h3 { margin-top: 0; color: #888; font-size: 0.9rem; text-transform: uppercase; }
        .value { font-size: 2rem; font-weight: bold; margin: 10px 0; }
        .sub { font-size: 0.8rem; color: #555; }
        
        .vip-active { border-color: #ffd700; box-shadow: 0 0 20px rgba(255,215,0,0.1); }
        .vip-text { color: #ffd700; text-shadow: 0 0 10px #ffd700; }

        /* ROCKET DONATION */
        .rocket-box {
            grid-column: 1 / -1; margin-top: 40px; text-align: center;
            background: linear-gradient(180deg, rgba(20,241,149,0.05), rgba(0,212,255,0.05));
            border: 1px dashed #444; border-radius: 20px; padding: 40px;
        }
        .rocket-btn {
            font-size: 4rem; background: none; border: none; cursor: pointer; transition: 0.4s;
        }
        .rocket-btn:hover { transform: scale(1.2) rotate(-10deg); filter: drop-shadow(0 0 15px #fff); }

        .contract-addr { font-family: monospace; color: #00d2ff; cursor: pointer; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo"><i class="fa-solid fa-layer-group"></i> SKYAI PILOT</div>
            <a href="../index.html" class="back-link"><i class="fa-solid fa-right-from-bracket"></i> Logout</a>
        </div>

        <p style="color:#888;">Logged in as: <span id="userAddr" style="color:#fff; font-family:monospace;">...</span></p>

        <div class="grid">
            <div class="card" id="statusCard">
                <h3>Membership Tier</h3>
                <div class="value" id="status">Checking...</div>
                <div class="sub">Requires 5,000 SKY</div>
            </div>

            <div class="card">
                <h3>Token Balance</h3>
                <div class="value" id="skyBal">0.00</div>
                <div class="sub" onclick="copyContract()">Contract: <span class="contract-addr">0xcBba...fa83</span></div>
            </div>
            
            <div class="card">
                <h3>Native Balance</h3>
                <div class="value" id="nativeBal">0.00</div>
                <div class="sub" id="chainLabel">BNB/SOL</div>
            </div>
        </div>

        <div class="rocket-box">
            <h2 style="margin-top:0;">ðŸš€ Support the Developer</h2>
            <p style="color:#aaa;">Direct donation to Founder. Funds development.</p>
            <p id="donateStatus" style="font-weight:bold; color:#00d2ff;">Ready</p>
            
            <button class="rocket-btn" onclick="donate()">ðŸš€</button>
            <p style="font-size:0.8rem; color:#666;">(Sends 0.02 BNB or 0.1 SOL)</p>
        </div>
    </div>

    <script>
        // CONFIG
        const OWNER_BNB = "0xc98415672A80a26bEC29427b7284D65B73c5Ff7B";
        const OWNER_SOL = "4iubzdpP14Mo32iRseD7nZEhP1RVLWjjwbsh228uBk3z";
        const TOKEN = "0xcBbaDC40Cde0F12679a6b0b74fB732E02E60fa83";
        const TOKEN_ABI = ["function balanceOf(address) view returns (uint256)"];

        // STATE
        let userAddr, chain;

        window.onload = async () => {
            userAddr = localStorage.getItem('skyai_wallet');
            chain = localStorage.getItem('skyai_chain');

            if(!userAddr) { window.location.href = "../index.html"; return; }
            
            document.getElementById('userAddr').innerText = userAddr;
            document.getElementById('chainLabel').innerText = chain + " Chain";

            if (chain === 'BNB') await loadBNB();
            else if (chain === 'SOLANA') await loadSolana();
        }

        // --- BNB DATA ---
        async function loadBNB() {
            const provider = new ethers.providers.JsonRpcProvider("https://bsc-dataseed.binance.org/");
            
            // Native Bal
            const bal = await provider.getBalance(userAddr);
            document.getElementById('nativeBal').innerText = parseFloat(ethers.utils.formatEther(bal)).toFixed(4);

            // Token Bal
            const contract = new ethers.Contract(TOKEN, TOKEN_ABI, provider);
            const tBal = await contract.balanceOf(userAddr);
            const fmtTBal = parseFloat(ethers.utils.formatEther(tBal));
            document.getElementById('skyBal').innerText = fmtTBal.toLocaleString();

            if(fmtTBal >= 5000) activateVIP();
            else document.getElementById('status').innerText = "Free Pilot";
        }

        // --- SOLANA DATA (Mock for now as public RPCs are tricky for tokens without API key) ---
        async function loadSolana() {
            document.getElementById('skyBal').innerText = "BSC Only"; 
            document.getElementById('status').innerText = "Solana Guest";
            
            // Try to get SOL balance via public RPC
            try {
                const connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl('mainnet-beta'));
                const pubKey = new solanaWeb3.PublicKey(userAddr);
                const bal = await connection.getBalance(pubKey);
                document.getElementById('nativeBal').innerText = (bal / 1000000000).toFixed(4);
            } catch(e) { console.log(e); }
        }

        function activateVIP() {
            const el = document.getElementById('status');
            el.innerText = "â˜… VIP COMMANDER";
            el.classList.add('vip-text');
            document.getElementById('statusCard').classList.add('vip-active');
        }

        // --- DONATION LOGIC ---
        async function donate() {
            const status = document.getElementById('donateStatus');
            status.innerText = "Initiating Launch...";

            try {
                if (chain === 'BNB') {
                    // MetaMask / Trust
                    const provider = new ethers.providers.Web3Provider(window.ethereum);
                    const signer = provider.getSigner();
                    const tx = await signer.sendTransaction({
                        to: OWNER_BNB,
                        value: ethers.utils.parseEther("0.02")
                    });
                    status.innerText = "BNB Sent! ðŸš€";
                    await tx.wait();
                    alert("Support Received! Thank you!");
                } 
                else if (chain === 'SOLANA') {
                    // Phantom
                    const connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl('mainnet-beta'));
                    const transaction = new solanaWeb3.Transaction().add(
                        solanaWeb3.SystemProgram.transfer({
                            fromPubkey: window.solana.publicKey,
                            toPubkey: new solanaWeb3.PublicKey(OWNER_SOL),
                            lamports: 0.1 * 1000000000, 
                        })
                    );
                    const { blockhash } = await connection.getLatestBlockhash();
                    transaction.recentBlockhash = blockhash;
                    transaction.feePayer = window.solana.publicKey;
                    
                    const { signature } = await window.solana.signAndSendTransaction(transaction);
                    status.innerText = "SOL Sent! ðŸš€";
                    await connection.confirmTransaction(signature);
                    alert("Support Received! Thank you!");
                }
            } catch (e) {
                status.innerText = "Launch Aborted.";
                console.error(e);
            }
        }

        function copyContract() {
            navigator.clipboard.writeText(TOKEN);
            alert("Contract Copied!");
        }
    </script>
</body>
</html>
